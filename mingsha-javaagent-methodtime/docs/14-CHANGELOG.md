# 变更日志

## [0.0.1-SNAPSHOT] - 2025-07-12

### 🐛 修复
- **字节码增强兼容性修复**：
  - 修复 `VerifyError: Bad type on operand stack` 错误
  - 修复 `VerifyError: Expecting a stackmap frame at branch target` 错误
  - 修复包名错误：将 `site.mingsha.javaagent.collector.*` 更正为 `site.mingsha.javaagent.methodtime.collector.*`
  - 优化栈帧计算：使用 `ClassWriter.COMPUTE_FRAMES` 替代 `ClassWriter.COMPUTE_MAXS`
  - 修复采样率逻辑的字节码生成错误
  - 修复最小耗时过滤的栈操作问题

### 🔧 技术改进
- **ASM 字节码增强优化**：
  - 基于 ASM 9.5，支持 Java 8-21 版本
  - 自动栈帧计算，提升兼容性
  - 优化字节码生成逻辑，减少验证错误
  - 改进采样率和过滤逻辑的字节码实现

### 📚 文档更新
- **故障排查指南**：
  - 新增字节码增强相关问题的诊断和解决方案
  - 详细记录 VerifyError 错误的修复过程
  - 提供调试技巧和分步骤验证方法
  - 更新快速开始文档，添加兼容性说明

### 🎯 兼容性说明
- **Java 版本支持**：Java 8+ (推荐 Java 11+)
- **字节码增强**：基于 ASM 9.5，支持现代 Java 版本
- **向后兼容**：保持现有 API 和配置格式不变

### 📋 已知问题
- 无

### 🔮 计划功能
- 支持更多字节码增强场景
- 优化内存使用和性能
- 增强监控和告警功能

---

## 版本说明

### 版本号规则
- **主版本号**：重大功能变更或架构调整
- **次版本号**：新功能添加，向后兼容
- **修订版本号**：Bug 修复，向后兼容
- **快照版本**：开发中的版本，不稳定

### 升级指南
1. **从旧版本升级**：
   - 备份现有配置和数据
   - 下载新版本 Agent
   - 更新启动参数（如有变化）
   - 重启应用

2. **配置变更**：
   - 检查配置项是否有变化
   - 更新 JVM 系统属性（如有需要）
   - 验证配置生效

3. **数据迁移**：
   - 导出现有数据（如需要）
   - 新版本会自动处理数据格式变更
   - 验证数据完整性

### 支持策略
- **当前版本**：完整支持，包括 Bug 修复和新功能
- **上一个版本**：Bug 修复支持
- **更早版本**：社区支持，无官方维护

### 反馈渠道
- **Issue 报告**：在项目仓库提交 Issue
- **功能建议**：通过 Issue 或讨论区提出
- **Bug 反馈**：提供详细的错误信息和复现步骤 